"use strict";angular.module("sosickBoilerplate.account",["ui.state"]).config(function($stateProvider){$stateProvider.state("account",{url:"/account",controller:"AccountCtrl",templateUrl:"account/account.tpl.html"})}).controller("AccountCtrl",function(){}),angular.module("sosickBoilerplate.admin").factory("admin",function($http,$q){function decorateUser(user){return user.isAdmin=function(){return _.contains(user.roles,"admin")},user}function updateUser(user){$http.put("/api/v1/users/"+user._id,user).then(function(result){users[users.indexOf(user)]=decorateUser(result.data)})}function allUsers(){var deferred=$q.defer();return $http.get("/api/v1/users",{cache:!0}).success(function(data){users=_.map(data,decorateUser),deferred.resolve(users)}).error(function(error){deferred.reject(error)}),deferred.promise}var users=[],output={users:allUsers,updateUser:updateUser};return output}),angular.module("sosickBoilerplate.admin",["ui.state"]).config(function($stateProvider){$stateProvider.state("admin",{url:"/admin",controller:"AdminCtrl",templateUrl:"admin/admin.tpl.html",resolve:{users:function(admin){return admin.users()}}})}).controller("AdminCtrl",function($scope,users,admin){$scope.users=users,$scope.setAdmin=function(user){user.roles.push("admin"),admin.updateUser(user)},$scope.removeAdmin=function(user){user.roles=_.without(user.roles,"admin"),admin.updateUser(user)}}),angular.module("monitorSystem",["templates-app","monitorSystem.home","monitorSystem.auth","monitorSystem.register","ui.router","ui.bootstrap","ngCookies","ngSanitize"]).config(function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/home")}).controller("AppCtrl",function($scope,userFactory){$scope.user=userFactory}),angular.module("monitorSystem.auth",["ui.router"]).config(function($stateProvider){$stateProvider.state("signin",{url:"/signin",controller:"AuthCtrl",templateUrl:"auth/auth.tpl.html"})}).controller("AuthCtrl",function($scope,userFactory){$scope.login=function(){userFactory.login($scope.username,$scope.password)}}),angular.module("monitorSystem").factory("socket",function($rootScope){var socket=io.connect();return{on:function(eventName,callback){socket.on(eventName,function(){var args=arguments;$rootScope.$apply(function(){callback.apply(socket,args)})})},emit:function(eventName,data,callback){socket.emit(eventName,data,function(){var args=arguments;$rootScope.$apply(function(){callback&&callback.apply(socket,args)})})}}}),angular.module("monitorSystem").factory("userFactory",function($cookies,$http,$location){function get(id){return $http.get("/api/v1/users/"+id).then(function(results){return results.data})}function logout(){return $http.post("/api/logout").then(function(){output.name=null,$location.path("/home")})}function login(username,password){return $http.post("/api/login",{_csrf:output.csrf,username:username,password:password}).success(function(user){output._id=user._id,$location.path("/home")})}function register(user){return user._csrf=output.csrf,$http.post("/api/register",user).success(function(fullName){output.name=fullName,$location.path("/home")})}var output={_id:$cookies["user._id"],name:$cookies["user.name.full"],csrf:$cookies.csrf,get:get,logout:logout,login:login,register:register};return output}),angular.module("monitorSystem.home",["ui.router"]).config(function($stateProvider){$stateProvider.state("home",{url:"/home",controller:"HomeCtrl",templateUrl:"home/home.tpl.html"})}).controller("HomeCtrl",function($scope,socket){socket.on("init",function(data){$scope.devices=data.devices}),socket.on("device:add",function(data){$scope.devices.push(data.device)}),socket.on("device:change",function(data){_.forEach($scope.devices,function(item){item._id===data.device._id&&(item=data.device)})}),$scope.alerts=[],$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.toggleDevice=function(device){socket.emit("device:toggle",{device:device})}}),angular.module("monitorSystem.register",["ui.router"]).config(function($stateProvider){$stateProvider.state("register",{url:"/register",controller:"RegisterCtrl",templateUrl:"register/register.tpl.html"})}).controller("RegisterCtrl",function($scope,userFactory){$scope.register=function(){var newUser={username:$scope.username,password:$scope.password,passwordRepeat:$scope.passwordRepeat,firstName:$scope.firstName,lastName:$scope.lastName};userFactory.register(newUser).error(function(result){$scope.errors=result.errors})}}),angular.module("templates-app",["account/account.tpl.html","admin/admin.tpl.html","auth/auth.tpl.html","home/home.tpl.html","register/register.tpl.html"]),angular.module("account/account.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("account/account.tpl.html",'<h1>Account Page</h1>\n<button class="btn btn-danger" ng-click="user.logout()">Logout</button>')}]),angular.module("admin/admin.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("admin/admin.tpl.html",'<h1>Admin Area</h1>\n\n<div class="panel panel-default">\n  <div class="panel-heading">\n    <h3 class="panel-title">Users</h3>\n  </div>\n  <div class="panel-body">\n    <ul class="list-group">\n      <li ng-repeat="user in users" class="list-group-item">\n        <span class="badge" ng-if="user.isAdmin()">Admin</span>\n        <h4 class="list-group-item-heading">{{user.name.first}} {{user.name.last}}</h4>\n        <p class="list-group-item-text">\n          Joined on: {{user.createdAt | date}}\n          <span ng-if="user.isAdmin()"><br /><a ng-click="removeAdmin(user)">Remove Admin Status</a></span>\n          <span ng-if="!user.isAdmin()"><br /><a ng-click="setAdmin(user)">Set Admin Status</a></span>\n        </p>\n      </li>\n    </ul>\n  </div>\n</div>')}]),angular.module("auth/auth.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("auth/auth.tpl.html",'<form>\n\n  <div class="alert alert-danger" ng-if="errors.length">\n    <div ng-repeat="message in errors" ng-hide="message.hidden" ng-bind-html="message"></div>\n  </div>\n\n  <h2>Please log in</h2>\n\n  <div class="row form-group">\n    <div class="col-lg-11">\n      <input type="text" class="form-control" name="username" placeholder="e-mail address" ng-model="username"></input>\n    </div>\n  </div>\n\n  <div class="row form-group">\n    <div class="col-lg-11">\n      <input type="password" ng-model="password" class="form-control" name="password" placeholder="password"></input>\n    </div>\n  </div>\n\n  <hr>\n\n  <div class="row form-group">\n    <div class="col-lg-offset-2 col-lg-10">\n      <button class="btn btn-default btn-large" ng-click="login()">Login</button>\n      <a class="btn btn-large" href="#/register">Register</a>\n    </div>\n  </div>\n\n  <hr>\n</form>\n')}]),angular.module("home/home.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("home/home.tpl.html",'<alert ng-repeat="alert in alerts" type="alert.type" close="closeAlert($index)">{{alert.msg}}</alert>\n\n<ul>\n  <li ng-repeat="device in devices">\n    <input type="checkbox" class="col-md-3" ng-model="device.status" ng-change="emitChange(device)"></input>\n    <div class="col-md-4">\n      {{device.status}}\n    </div>\n    <div class="col-md-5">\n      {{device.current}}\n    </div>\n  </li>\n</ul>')}]),angular.module("register/register.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("register/register.tpl.html",'<form class="register form-horizontal" novalidate>\n  <div class="alert alert-danger" ng-if="errors.length">\n    <div ng-repeat="message in errors" ng-hide="message.hidden" ng-bind-html="message"></div>\n  </div>\n\n  <h2>New account</h2>\n\n  <div class="row form-group">\n    <div class="col-lg-11">\n      <input type="text" ng-required class="form-control" name="username" placeholder="e-mail address" ng-model="username"></input>\n    </div>\n  </div>\n\n  <div class="row form-group">\n    <div class="col-lg-11">\n      <input type="password" ng-required ng-model="password" class="form-control" name="password" placeholder="password"></input>\n    </div>\n  </div>\n\n  <div class="row form-group">\n    <div class="col-lg-11">\n      <input type="password" ng-required class="form-control" ng-model="passwordRepeat" name="passwordRepeat" placeholder="repeat password"></input>\n    </div>\n  </div>\n\n  <div class="row form-group">\n    <div class="row col-lg-11">\n      <div class="col-6" style="padding-right: 0;">\n        <input type="text" ng-required class="form-control" name="firstName" placeholder="first name" ng-model="firstName"></input>\n      </div>\n      <div class="col-6" style="padding-right: 0;">\n        <input type="text" ng-required class="form-control" name="lastName" placeholder="last name" ng-model="lastName"></input>\n      </div>\n    </div>\n  </div>\n\n  <hr>\n\n  <div class="row form-group">\n    <div class="col-lg-offset-2 col-lg-10">\n      <button class="btn btn-default btn-large" ng-click="register()">Register</button>\n    </div>\n  </div>\n</form>')}]),angular.module("ui.route",[]).directive("uiRoute",["$location","$parse",function($location,$parse){return{restrict:"AC",scope:!0,compile:function(tElement,tAttrs){var useProperty;if(tAttrs.uiRoute)useProperty="uiRoute";else if(tAttrs.ngHref)useProperty="ngHref";else{if(!tAttrs.href)throw new Error("uiRoute missing a route or href property on "+tElement[0]);useProperty="href"}return function($scope,elm,attrs){function staticWatcher(newVal){(hash=newVal.indexOf("#"))>-1&&(newVal=newVal.substr(hash+1)),watcher=function(){modelSetter($scope,$location.path().indexOf(newVal)>-1)},watcher()}function regexWatcher(newVal){(hash=newVal.indexOf("#"))>-1&&(newVal=newVal.substr(hash+1)),watcher=function(){var regexp=new RegExp("^"+newVal+"$",["i"]);modelSetter($scope,regexp.test($location.path()))},watcher()}var modelSetter=$parse(attrs.ngModel||attrs.routeModel||"$uiRoute").assign,watcher=angular.noop;switch(useProperty){case"uiRoute":attrs.uiRoute?regexWatcher(attrs.uiRoute):attrs.$observe("uiRoute",regexWatcher);break;case"ngHref":attrs.ngHref?staticWatcher(attrs.ngHref):attrs.$observe("ngHref",staticWatcher);break;case"href":staticWatcher(attrs.href)}$scope.$on("$routeChangeSuccess",function(){watcher()}),$scope.$on("$stateChangeSuccess",function(){watcher()})}}}}]);